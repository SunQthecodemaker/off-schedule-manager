# 스케줄 자동 배정 시스템 이식 기획서 (AppSheet 스타일)

## 1. 배경
현재 웹사이트의 "드래그 앤 드롭" 방식 스케줄링이 불편하여, AppSheet(구글 시트)에서 사용하던 **"자동 배정 & 통계 뷰"** 방식을 웹사이트에 도입하고자 합니다.
데이터만 연동하는 것이 아니라, **자동 배정 로직과 UI 자체를 웹사이트로 이식**하여 웹에서도 버튼 하나로 스케줄을 짜고, 직관적인 표 형태로 검수할 수 있게 만드는 것이 목표입니다.

## 2. 핵심 기능 이식

### A. 자동 배정 알고리즘 (`schedule-generator.js`)
`스케줄표 v3 앱스크립트.txt`의 `generateSchedule` 및 `calculateAllocation` 로직을 JavaScript로 변환합니다.

1. **입력 데이터**:
   - `employees` (Supabase DB): 이름, 고정 휴무일(offDay), 선호 팀(team1, team2) 등
   - `leaves` (DB): 승인된 연차
   - `holidays` (DB/API): 공휴일 정보
   - `doctors` (Config): 원장님별 TO 및 휴무 규칙

2. **로직 (JavaScript Porting)**:
   - `planWeeklyRotation`: 주간 로테이션 휴무 배정
   - `calculateAllocation`: 일별 근무자 배정 (1지망/2지망 팀 고려, TO 맞추기, 5명 제한 등)
   - **결과**: `schedules` 배열 생성 (DB 저장 가능 형태)

### B. AppSheet 스타일 뷰 (`Smart View`)
기존 캘린더 뷰 외에, 엑셀/AppSheet와 유사한 **"스마트 테이블 뷰"**를 추가합니다.

1. **Table UI**: 날짜(행) x 원장님(열) 형태의 매트릭스 뷰
2. **실시간 통계**: 각 날짜/원장님 별 `[+2 여유]`, `[-1 부족]` 등의 상태를 색상으로 표시
   - 원본 코드의 `renderWideGrid` 로직을 HTML Table로 구현
3. **주간 검수 리포트**: 우측에 주간 근무일수 및 휴무일 요약 표시 (`printWeeklyStatsWithOffDays` 로직)

## 3. 구현 단계

### 1단계: 로직 모듈화
- `schedule-generator.js` 파일을 새로 생성하여, 앱스크립트의 배정 로직을 순수 JS 함수로 변환합니다.

### 2단계: UI 구현
- **[자동 배정] 버튼**: 클릭 시 위 로직을 실행하고 결과를 보여줍니다.
- **[스마트 뷰] 토글**: 기존 캘린더 뷰 <-> 스마트 테이블 뷰 전환 기능을 추가합니다.

### 3단계: 통합
- 자동 생성된 결과를 임시 상태(Unsaved Changes)로 화면에 뿌려주고, 사용자가 확인 후 `[저장]` 누르면 DB에 반영되도록 합니다.

## 4. 기대 효과
- 엑셀 파일을 왔다갔다 할 필요 없이 **웹에서 바로 자동 스케줄링** 가능
- 기존의 수동 드래그 방식은 **세부 수정용**으로 유지하여 유연성 확보
- AppSheet의 장점(자동화, 통계)과 웹의 장점(접근성, DB연동)을 모두 취함
