<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì—°ì°¨ ë° ìŠ¤ì¼€ì¤„ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script>
        // âœ¨ Force Unregister Service Workers to clear cache issues
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    console.log('Unregistering Service Worker:', registration);
                    registration.unregister();
                }
            });
        }

        window.onerror = function (message, source, lineno, colno, error) {
            alert('ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë°œìƒ:\n' + message + '\n' + source + ':' + lineno);
        };
    </script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css?v=20251022-mobile" />

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/isSameOrAfter.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/isSameOrBefore.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen p-4">

    <div id="app">
        <div id="login-screen" class="page-section flex flex-col items-center justify-center min-h-screen">
            <div class="max-w-xl w-full bg-white rounded shadow p-6 text-center">
                <h1 class="text-3xl font-bold mb-6">ì—°ì°¨ ë° ìŠ¤ì¼€ì¤„ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <div id="login-forms-container">
                    <div id="employeeLoginContainer" class="space-y-4">
                        <h2 class="text-xl font-semibold">ì§ì› ë¡œê·¸ì¸</h2>
                        <form id="employeeLoginForm" class="space-y-3">
                            <input type="text" id="empLoginName" placeholder="ì§ì› ì´ë¦„" class="w-full border p-3 rounded"
                                required />
                            <input type="password" id="empLoginPass" placeholder="ë¹„ë°€ë²ˆí˜¸"
                                class="w-full border p-3 rounded" required />
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded">ë¡œê·¸ì¸</button>
                        </form>
                        <button type="button" id="goToOwnerLoginBtn" class="text-blue-600 underline">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
                    </div>
                    <div id="ownerLoginContainer" class="hidden space-y-4">
                        <h2 class="text-xl font-semibold">ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
                        <form id="adminLoginForm" class="space-y-3">
                            <input type="email" id="adminLoginId" placeholder="ê´€ë¦¬ì ì´ë©”ì¼"
                                class="w-full border p-3 rounded" required />
                            <input type="password" id="adminLoginPass" placeholder="ë¹„ë°€ë²ˆí˜¸"
                                class="w-full border p-3 rounded" required />
                            <button type="submit" class="w-full bg-green-600 text-white py-2 rounded">ë¡œê·¸ì¸</button>
                        </form>
                        <button type="button" id="goToEmployeeLoginBtn" class="text-blue-600 underline">ì§ì›
                            ë¡œê·¸ì¸ìœ¼ë¡œ</button>
                    </div>
                </div>
                <div id="password-reset-container" class="hidden space-y-4">
                    <h2 class="text-xl font-semibold">ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</h2>
                    <p class="text-sm text-gray-600">ìƒˆë¡­ê²Œ ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                    <form id="passwordResetForm" class="space-y-3">
                        <input type="password" id="newPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (6ìë¦¬ ì´ìƒ)"
                            class="w-full border p-3 rounded" required />
                        <button type="submit" class="w-full bg-purple-600 text-white py-2 rounded">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½í•˜ê¸°</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="employee-portal" class="page-section hidden"></div>
        <div id="admin-portal" class="page-section hidden"></div>
    </div>

    <!-- âœ¨ Right-Click Context Menu -->
    <div id="custom-context-menu-v2"
        class="hidden absolute bg-white shadow-lg rounded-lg border border-gray-200 py-1 z-50 text-sm min-w-[150px]">
        <div id="ctx-register-leave-v2"
            class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-gray-700 font-medium transition-colors hover:text-blue-600">
            ğŸ–ï¸ ì—°ì°¨ ë“±ë¡í•˜ê¸°
        </div>
        <div id="ctx-cancel-leave-v2"
            class="hidden px-4 py-2 hover:bg-red-50 cursor-pointer text-gray-700 font-medium transition-colors hover:text-red-600">
            ğŸ—‘ï¸ ì—°ì°¨ ì·¨ì†Œí•˜ê¸°
        </div>
        <div class="border-t border-gray-100 my-1"></div>
        <div id="ctx-close-menu" class="px-4 py-2 hover:bg-gray-50 cursor-pointer text-gray-500">
            ë‹«ê¸°
        </div>
    </div>

    <div id="reorder-modal" class="modal-overlay hidden">
        <div class="modal-content-sm">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 id="reorder-modal-title" class="text-2xl font-bold">ê·¼ë¬´ ìˆœì„œ ë³€ê²½</h2>
                <button id="close-reorder-modal-btn" class="text-3xl">&times;</button>
            </div>
            <div id="reorder-list" class="space-y-2 mb-4 min-h-[100px] max-h-[400px] overflow-y-auto">
            </div>
            <div class="flex justify-end space-x-3 pt-4 border-t">
                <button type="button" id="cancel-reorder-btn" class="px-4 py-2 bg-gray-300 rounded">ì·¨ì†Œ</button>
                <button type="button" id="save-reorder-btn" class="px-4 py-2 bg-blue-600 text-white rounded">ìˆœì„œ
                    ì €ì¥</button>
            </div>
        </div>
    </div>

    <div id="leave-form-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold">ì—°ì°¨ ì‹ ì²­ì„œ</h2>
                <button id="close-modal-btn" class="text-3xl">&times;</button>
            </div>
            <div>
                <div class="space-y-4">
                    <div>
                        <label class="font-semibold">ì‹ ì²­ì</label>
                        <p id="form-applicant-name" class="mt-1 p-2 bg-gray-100 rounded"></p>
                    </div>
                    <div>
                        <label class="font-semibold">ì‹ ì²­ ë‚ ì§œ</label>
                        <div id="form-selected-dates" class="mt-1 p-2 bg-gray-100 rounded min-h-[40px]"></div>
                    </div>
                    <div>
                        <label for="form-reason" class="font-semibold">ì‚¬ìœ  (ì„ íƒ)</label>
                        <textarea id="form-reason" rows="3" class="w-full mt-1 p-2 border rounded"></textarea>
                    </div>

                    <!-- ë‹¹ê²¨ì“°ê¸° ë™ì˜ ì„¹ì…˜ (ìˆ¨ê¹€ ì²˜ë¦¬) -->
                    <div id="borrowing-agreement-section"
                        class="hidden bg-red-50 border border-red-200 rounded p-3 text-red-700 space-y-2">
                        <div class="font-bold flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                                </path>
                            </svg>
                            ì—°ì°¨ ë‹¹ê²¨ì“°ê¸° ê²½ê³ 
                        </div>
                        <p class="text-sm">
                            í˜„ì¬ ì”ì—¬ ì—°ì°¨ê°€ ë¶€ì¡±í•˜ì—¬ <span id="borrowing-amount" class="font-bold"></span>ì¼ì„ ë‚´ë…„ ì—°ì°¨ì—ì„œ ë‹¹ê²¨ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
                        </p>
                        <div class="flex items-start items-center gap-2 mt-2">
                            <input type="checkbox" id="borrowing-agreement-check" class="mt-1 w-4 h-4">
                            <label for="borrowing-agreement-check" class="text-xs font-semibold">
                                ë³¸ì¸ì€ ë‚´ë…„ë„ ë°œìƒí•  ì—°ì°¨ë¥¼ ë¯¸ë¦¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ë™ì˜í•˜ë©°,<br>
                                ì¶”í›„ ë°œìƒ ì—°ì°¨ì—ì„œ ì°¨ê°ë˜ê±°ë‚˜ í‡´ì§ ì‹œ ì •ì‚°ë¨ì„ í™•ì¸í•©ë‹ˆë‹¤.
                            </label>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center">
                            <label class="font-semibold">ì„œëª…</label>
                            <button type="button" id="clear-signature-btn" class="text-sm text-blue-600">ë‹¤ì‹œ
                                ì„œëª…í•˜ê¸°</button>
                        </div>
                        <canvas id="signature-canvas" class="signature-canvas mt-1 w-full h-32 border"></canvas>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" id="cancel-submission-btn"
                            class="px-4 py-2 bg-gray-300 rounded">ì·¨ì†Œ</button>
                        <button type="button" id="submit-leave-form-btn"
                            class="px-4 py-2 bg-blue-600 text-white rounded">ìµœì¢… ì œì¶œ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="preview-modal" class="modal-overlay hidden">
        <div class="modal-content-lg">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 id="preview-modal-title" class="text-2xl font-bold">ì„œì‹ ë¯¸ë¦¬ë³´ê¸°</h2>
                <button id="close-preview-modal-btn" class="text-3xl">&times;</button>
            </div>
            <div id="preview-modal-body" class="document-preview-body bg-gray-100 p-8"></div>
        </div>
    </div>

    <div id="document-submission-modal" class="modal-overlay hidden">
        <div class="modal-content-lg">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 id="submission-modal-title" class="text-2xl font-bold">ì„œë¥˜ ì‘ì„±</h2>
                <button id="close-submission-modal-btn" class="text-3xl">&times;</button>
            </div>
            <div id="submission-modal-body" class="document-preview-body bg-white p-8"></div>
            <div class="flex justify-end space-x-3 pt-4 mt-4 border-t">
                <button type="button" id="cancel-doc-submission-btn" class="px-6 py-2 bg-gray-300 rounded">ì·¨ì†Œ</button>
                <button type="button" id="submit-doc-submission-btn"
                    class="px-6 py-2 bg-blue-600 text-white rounded">ì œì¶œí•˜ê¸°</button>
            </div>
        </div>
    </div>

    <div id="issue-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold">ì„œë¥˜ ì œì¶œ ìš”ì²­</h2>
                <button id="close-issue-modal-btn" class="text-3xl">&times;</button>
            </div>
            <form id="issue-form">
                <input type="hidden" id="issue-employee-id">
                <div class="space-y-4">
                    <div>
                        <label class="font-semibold">ëŒ€ìƒ ì§ì›</label>
                        <p id="issue-employee-name" class="mt-1 p-2 bg-gray-100 rounded"></p>
                    </div>
                    <div>
                        <label for="issue-type" class="font-semibold">ì´ìŠˆ ìœ í˜•</label>
                        <select id="issue-type" class="w-full mt-1 p-2 border rounded" required>
                            <option value="document_request">íŠ¹ì • ì„œë¥˜ ì œì¶œ ìš”ì²­</option>
                            <option value="unauthorized_absence">ë¬´ë‹¨ê²°ê·¼ ì²˜ë¦¬</option>
                            <option value="sick_leave">ë³‘ê°€ ì²˜ë¦¬</option>
                            <option value="other">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div>
                        <label for="issue-details" class="font-semibold">ìƒì„¸ ë‚´ìš©</label>
                        <textarea id="issue-details" rows="3" class="w-full mt-1 p-2 border rounded"
                            placeholder="ì§ì›ì—ê²Œ ì „ë‹¬ë  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”. (ì˜ˆ: 9/17 ë¬´ë‹¨ê²°ê·¼ìœ¼ë¡œ ì¸í•œ ê²½ìœ„ì„œ ì œì¶œ ìš”ì²­)"></textarea>
                    </div>
                    <div>
                        <label for="issue-required-doc" class="font-semibold">ìš”ì²­í•  ì„œë¥˜ (ì„ íƒ)</label>
                        <select id="issue-required-doc" class="w-full mt-1 p-2 border rounded">
                            <option value="">-- ì„œë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" id="cancel-issue-btn" class="px-4 py-2 bg-gray-300 rounded">ì·¨ì†Œ</button>
                        <button type="submit"
                            class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-bold">ìš”ì²­ ìƒì„±</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="bulk-register-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold">ì§ì› ëŒ€ëŸ‰ ë“±ë¡</h2>
                <button id="close-bulk-modal-btn" class="text-3xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="font-semibold block mb-2">ì—‘ì…€, ì‹œíŠ¸ ë“±ì—ì„œ ë³µì‚¬í•œ ë°ì´í„°ë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</label>
                    <p class="text-sm text-gray-600 mb-2">
                        - í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥í•´ì£¼ì„¸ìš”.<br>
                        - ê° í•­ëª©ì€ íƒ­(Tab)ìœ¼ë¡œ êµ¬ë¶„ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.<br>
                        - ìˆœì„œ: <span class="font-mono text-blue-600">ì´ë¦„ (Tab) ì…ì‚¬ì¼(YYYY-MM-DD) (Tab) ì´ë©”ì¼ (Tab) ì´ˆê¸°ë¹„ë°€ë²ˆí˜¸
                            (Tab) ë¶€ì„œëª…</span>
                    </p>
                    <textarea id="bulk-employee-data" rows="10" class="w-full mt-1 p-2 border rounded font-mono text-sm"
                        placeholder="ì˜ˆì‹œ)&#10;í™ê¸¸ë™	2025-01-15	hong@example.com	123456	ì§„ë£ŒíŒ€&#10;ì´ìˆœì‹ 	2024-03-01	lee@example.com	123456	ë°ìŠ¤í¬íŒ€"></textarea>
                </div>
                <div id="bulk-register-result"
                    class="text-sm p-2 bg-gray-100 rounded min-h-[80px] whitespace-pre-wrap overflow-y-auto"></div>
                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button type="button" id="cancel-bulk-submission-btn"
                        class="px-4 py-2 bg-gray-300 rounded">ì·¨ì†Œ</button>
                    <button type="button" id="submit-bulk-register-btn"
                        class="px-4 py-2 bg-blue-600 text-white rounded">ë“±ë¡í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        @media print {
            .fc-event-main-custom {
                font-size: 6pt !important;
            }

            .custom-event-name {
                font-size: 5pt !important;
                font-weight: 600 !important;
            }
        }

        .employee-tab-btn {
            transition: all 0.2s ease;
        }

        .employee-tab-btn:hover {
            background-color: #f3f4f6;
        }
    </style>

    <script type="module" src="main.v2.js"></script>
    <script type="module" src="schedule.js?v=2.2"></script>
    <script type="module" src="management.js?v=2.2"></script>
    <script type="module" src="employee-portal-final.js?v=2.2"></script>
    <script type="module">
        import { closeLeaveFormModal, handleSubmitLeaveRequest } from './employee-portal-final.js';

        document.addEventListener('DOMContentLoaded', () => {
            // ì—°ì°¨ ì‹ ì²­ ëª¨ë‹¬ ê´€ë ¨
            document.getElementById('close-modal-btn')?.addEventListener('click', closeLeaveFormModal);
            document.getElementById('cancel-submission-btn')?.addEventListener('click', closeLeaveFormModal);
            document.getElementById('submit-leave-form-btn')?.addEventListener('click', handleSubmitLeaveRequest);

            document.getElementById('clear-signature-btn')?.addEventListener('click', () => {
                if (window.signaturePad) {
                    window.signaturePad.clear();
                }
            });

            // ì´ìŠˆ ëª¨ë‹¬ ê´€ë ¨
            document.getElementById('close-issue-modal-btn')?.addEventListener('click', () => {
                document.getElementById('issue-modal').classList.add('hidden');
            });

            document.getElementById('cancel-issue-btn')?.addEventListener('click', () => {
                document.getElementById('issue-modal').classList.add('hidden');
            });

            document.getElementById('issue-form')?.addEventListener('submit', window.handleIssueSubmit);
        });
    </script>
</body>

</html>